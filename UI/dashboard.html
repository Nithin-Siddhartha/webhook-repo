<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Webhook Activity Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <script>
    function fetchEvents() {
      fetch("/events")
        .then(response => response.json())
        .then(data => {
          const tableBody = document.getElementById("events-table-body");
          tableBody.innerHTML = "";
          data.reverse().forEach(event => {
          const row = document.createElement("tr");
          const options = {
            day: 'numeric',
            month: 'long',
            year: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          hour12: true,
          timeZone: 'Asia/Kolkata'
        };
        const formattedTime = new Date(event.timestamp).toLocaleString("en-IN", options);

        if (event.type === "pull_request" && event.merged) {
          row.innerHTML = `
            <td colspan="5" class="text-success text-center">
              <strong>${event.author}</strong> merged branch <strong>${event.from_branch}</strong> to <strong>${event.to_branch}</strong> on ${formattedTime} IST
            </td>
          `;
        } else {
          row.innerHTML = `
          <td>${event.type}</td>
          <td>${event.author}</td>
          <td>${event.from_branch || "-"}</td>
          <td>${event.to_branch || "-"}</td>
          <td>${formattedTime}</td>
        `;
        }
        tableBody.appendChild(row);
      });
        });
    }

    // Here it fetches events every 15 seconds
    setInterval(fetchEvents, 15000);
    window.onload = fetchEvents;
  </script>
</head>

<body class="bg-light">
  <div class="container mt-5">
    <h2 class="mb-4 text-center">Webhook Activity Dashboard</h2>

    <table class="table table-bordered table-striped">
      <thead class="table-dark text-center">
        <tr>
          <th>Event</th>
          <th>Author</th>
          <th>Source Branch</th>
          <th>Target Branch</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody id="events-table-body" class="text-center">
      </tbody>
    </table>

    <p class="text-center text-muted small">Auto-refreshes every 15 seconds</p>
  </div>
</body>
</html>
